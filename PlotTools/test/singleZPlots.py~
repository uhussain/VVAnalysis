

from rootpy.plotting import Canvas, Legend
from rootpy.plotting.utils import draw

from SampleTools import MCSample, DataSample, SampleGroup, SampleStack
from PlotTools import PlotStyle as _Style
from PlotTools import makeLegend


style = _Style()

lumi = 12900.

channels = ['ee','mm']

mcWeight = {
    'ee' : 'e1EffScaleFactor * e2EffScaleFactor',
    'mm' : 'm1EffScaleFactor * m2EffScaleFactor',
    }
dyByChan = {
    c : MCSample('DYJets', c, 
                 '/data/nawoods/ntuples/singleZ_mc_11aug2016/results/DYJets*.root', 
                 True, lumi) for c in channels
    }
dy = SampleGroup('DYJets', 'z', dyByChan, True)

ttByChan = {
    c : MCSample('TTJets', c, 
                 '/data/nawoods/ntuples/singleZ_mc_11aug2016/results/TTJets*.root', 
                 True, lumi) for c in channels
    }
tt = SampleGroup('TTJets', 'z', ttByChan, True)

stack = SampleStack('stack', 'z', [dy,tt])


dataByChan = {}
for c in channels:
    samplesByEra = {}
    for era in ['b','c','d']:
        samplesByEra['2016{}'.format(era)] = DataSample('data2016{}_{}'.format(era, c), c, 
                                                        '/data/nawoods/ntuples/singleZ_data2016{}_11aug2016/results/*.root'.format(era)
                                                        )

    dataByChan[c] = SampleGroup('data_{}'.format(c), c, samplesByEra)

data = SampleGroup('Data', 'z', dataByChan)


massStack = stack.makeHist('Mass', '', [20, 60., 120.], mcWeight)
dataPts = data.makeHist('Mass', '', [20, 60., 120.], poissonErrors=True)

c = Canvas(1000,1000)

leg = makeLegend(c, massStack, dataPts)

draw([massStack, dataPts], c, xtitle='Mass (GeV)', ytitle='Events')
leg.Draw("same")

style.setCMSStyle(c, '', dataType='Preliminary', intLumi=lumi)
c.Print('/afs/cern.ch/user/n/nawoods/www/ZTestPlot.png')
                       
